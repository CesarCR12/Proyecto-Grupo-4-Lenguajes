<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF8" />
<script src="FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG/report.js" type="text/javascript"></script>
<link href="FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG/report.css" type="text/css" rel="stylesheet">
</head>
<body>
<div class="banner">
<table width="98%"><tr>
<td><h2 class="banner">FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG</h2></td>
</tr></table></div>
<div id="maintabs">
<div class="currentmaintab" onclick="onSelectMainTab(this, 0)">
<div>
<p>Doc</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 1)">
<div>
<p>Details</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 2)">
<div>
<p>Grants</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 3)">
<div>
<p>References</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 4)">
<div>
<p>Dependencies</p>
</div>
</div>
<div class="maintab" onclick="onSelectMainTab(this, 5)">
<div>
<p>Code</p>
</div>
</div>
</div>
<br/>
<div id="masterreports">
<div id="Master.0">
<div class="currentmasterreport">
<TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE><HR><P>-------ACA INICIAN LOS PROCEDIMIENTOS---------</P><HR><TABLE CELLSPACING="0" CELLPADDING="1" WIDTH="100%" BORDER="0">
<TR><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2">      SUMMARY:  <A HREF="#field_summary">FIELD</A> | <A HREF="#type_summary">TYPE</A> | <A HREF="#method_summary">METHOD</A></FONT></TD><TD CLASS="NavBarRow3" VALIGN="top"><FONT SIZE="-2"></TR></TABLE></div>
</div>
<div id="Master.1">
<div class="masterreport">
<table id="Table.0" cellpadding="0" cellspacing="0" summary="">
<th>NAME</th>
<th>VALUE</th>
</tr>
<tr>
<td>OWNER</td>
<td>SUMASTORECR</td>
</tr>
<tr>
<td>OBJECT_NAME</td>
<td>FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG</td>
</tr>
<tr>
<td>SUBOBJECT_NAME</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_ID</td>
<td>79641</td>
</tr>
<tr>
<td>DATA_OBJECT_ID</td>
<td>null</td>
</tr>
<tr>
<td>OBJECT_TYPE</td>
<td>PACKAGE&nbsp;BODY</td>
</tr>
<tr>
<td>CREATED</td>
<td>22/11/24</td>
</tr>
<tr>
<td>LAST_DDL_TIME</td>
<td>12/12/24</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>2024-12-12:16:34:31</td>
</tr>
<tr>
<td>STATUS</td>
<td>VALID</td>
</tr>
<tr>
<td>TEMPORARY</td>
<td>N</td>
</tr>
<tr>
<td>GENERATED</td>
<td>N</td>
</tr>
<tr>
<td>SECONDARY</td>
<td>N</td>
</tr>
<tr>
<td>NAMESPACE</td>
<td>2</td>
</tr>
<tr>
<td>EDITION_NAME</td>
<td>null</td>
</tr>
<tr>
<td>SHARING</td>
<td>NONE</td>
</tr>
<tr>
<td>EDITIONABLE</td>
<td>Y</td>
</tr>
<tr>
<td>ORACLE_MAINTAINED</td>
<td>N</td>
</tr>
<tr>
<td>APPLICATION</td>
<td>N</td>
</tr>
<tr>
<td>DEFAULT_COLLATION</td>
<td>null</td>
</tr>
<tr>
<td>DUPLICATED</td>
<td>N</td>
</tr>
<tr>
<td>SHARDED</td>
<td>N</td>
</tr>
<tr>
<td>IMPORTED_OBJECT</td>
<td>N</td>
</tr>
<tr>
<td>CREATED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>CREATED_VSNID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_APPID</td>
<td>null</td>
</tr>
<tr>
<td>MODIFIED_VSNID</td>
<td>null</td>
</tr>
</table>
</div>
</div>
<div id="Master.2">
<div class="masterreport">
<table id="Table.1" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>PRIVILEGE</th>
<th>GRANTEE</th>
<th>GRANTABLE</th>
<th>GRANTOR</th>
<th>OBJECT_NAME</th>
</tr>
</table>
</div>
</div>
<div id="Master.3">
<div class="masterreport">
<table id="Table.2" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.4">
<div class="masterreport">
<table id="Table.3" cellpadding="0" cellspacing="0" summary="">
<tr>
<th>NAME</th>
<th>OWNER</th>
<th>TYPE</th>
<th>OBJECT_ID</th>
<th>STATUS</th>
<th>TYPE_LINK</th>
</tr>
</table>
</div>
</div>
<div id="Master.5">
<div class="masterreport">
<pre>
PACKAGE BODY FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG AS
---------ACA INICIAN LOS PROCEDIMIENTOS---------
---------PROCEDIMIENTO PARA CREAR CLIENTE EN LA TABLA FIDE_CLIENTES---------
PROCEDURE FIDE_CLIENTES_TB_INSERTAR_CLIENTE_SP (
    P_NOMBRE IN VARCHAR2,
    P_CORREO IN VARCHAR2,
    P_CONTRASENA IN VARCHAR2,
    P_TELEFONO IN VARCHAR2,
    P_DIRECCION IN VARCHAR2,
    P_ID_PAIS IN VARCHAR2,
    P_ID_PROVINCIA IN VARCHAR2,
    P_ID_CANTON IN VARCHAR2,
    P_ID_DISTRITO IN VARCHAR2
) AS
BEGIN
    INSERT INTO FIDE_CLIENTES_TB (
        NOMBRE, CORREO, CONTRASENA, TELEFONO, DIRECCION, ID_PAIS, ID_PROVINCIA, ID_CANTON, ID_DISTRITO
    ) 
    VALUES (
        P_NOMBRE, P_CORREO, P_CONTRASENA, P_TELEFONO, P_DIRECCION, P_ID_PAIS, P_ID_PROVINCIA, P_ID_CANTON, P_ID_DISTRITO
    );

    COMMIT;
END;

---------PROCEDIMIENTO PARA ACTUALIZAR CLIENTE EN LA TABLA FIDE_CLIENTES---------
PROCEDURE FIDE_CLIENTES_TB_ACTUALIZAR_SP (
    P_ID_CLIENTE FIDE_CLIENTES_TB.FIDE_CLIENTES_TB_ID_CLIENTE_PK%TYPE,
    P_NOMBRE FIDE_CLIENTES_TB.NOMBRE%TYPE,
    P_CORREO FIDE_CLIENTES_TB.CORREO%TYPE,
    P_TELEFONO FIDE_CLIENTES_TB.TELEFONO%TYPE,
    P_DIRECCION FIDE_CLIENTES_TB.DIRECCION%TYPE,
    P_ID_PAIS FIDE_CLIENTES_TB.ID_PAIS%TYPE,
    P_ID_PROVINCIA FIDE_CLIENTES_TB.ID_PROVINCIA%TYPE,
    P_ID_CANTON FIDE_CLIENTES_TB.ID_CANTON%TYPE,
    P_ID_DISTRITO FIDE_CLIENTES_TB.ID_DISTRITO%TYPE
)
AS
BEGIN
    UPDATE FIDE_CLIENTES_TB
    SET
        NOMBRE = P_NOMBRE,
        CORREO = P_CORREO,
        TELEFONO = P_TELEFONO,
        DIRECCION = P_DIRECCION,
        ID_PAIS = P_ID_PAIS,
        ID_PROVINCIA = P_ID_PROVINCIA,
        ID_CANTON = P_ID_CANTON,
        ID_DISTRITO = P_ID_DISTRITO
    WHERE FIDE_CLIENTES_TB_ID_CLIENTE_PK = P_ID_CLIENTE;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Se modificaron los datos');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se cancelo la modificacion');
END FIDE_CLIENTES_TB_ACTUALIZAR_SP;

---------PROCEDIMIENTO PARA ELIMINAR CLIENTE EN LA TABLA FIDE_CLIENTES---------
PROCEDURE FIDE_CLIENTES_TB_ELIMINAR_SP (
    P_ID_CLIENTE FIDE_CLIENTES_TB.FIDE_CLIENTES_TB_ID_CLIENTE_PK%TYPE
)
AS
BEGIN
    DELETE FROM FIDE_CLIENTES_TB
    WHERE FIDE_CLIENTES_TB_ID_CLIENTE_PK = P_ID_CLIENTE;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El cliente con el ID ' || P_ID_CLIENTE || ' se eliminó');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al eliminar el cliente');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló el procedimiento');
END FIDE_CLIENTES_TB_ELIMINAR_SP;

---------PROCEDIMIENTO PARA ACTUALIZAR PROVEEDORES---------
PROCEDURE FIDE_PROVEEDORES_TB_ACTUALIZAR_SP (
    P_ID_PROVEEDOR FIDE_PROVEEDORES_TB.FIDE_PROVEEDORES_TB_ID_PROVEEDORES_PK%TYPE,
    P_DIRECCION FIDE_PROVEEDORES_TB.DIRECCION%TYPE,
    P_NOMBRE_PROVEEDOR FIDE_PROVEEDORES_TB.NOMBRE_PROVEEDOR%TYPE,
    P_TELEFONO FIDE_PROVEEDORES_TB.TELEFONO%TYPE,
    P_CORREO FIDE_PROVEEDORES_TB.CORREO%TYPE
)
AS
BEGIN
    UPDATE FIDE_PROVEEDORES_TB
    SET
        DIRECCION = P_DIRECCION,
        NOMBRE_PROVEEDOR = P_NOMBRE_PROVEEDOR,
        TELEFONO = P_TELEFONO,
        CORREO = P_CORREO
    WHERE FIDE_PROVEEDORES_TB_ID_PROVEEDORES_PK = P_ID_PROVEEDOR;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Se modificaron los datos');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al modificar');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la modificación');
END FIDE_PROVEEDORES_TB_ACTUALIZAR_SP;

---------PROCEDIMIENTO PARA ELIMINAR PROVEEDORES---------
PROCEDURE FIDE_PROVEEDORES_TB_ELIMINAR_SP (
    P_ID_PROVEEDOR FIDE_PROVEEDORES_TB.FIDE_PROVEEDORES_TB_ID_PROVEEDORES_PK%TYPE)
AS
BEGIN
    DELETE FROM FIDE_PROVEEDORES_TB
    WHERE FIDE_PROVEEDORES_TB_ID_PROVEEDORES_PK = P_ID_PROVEEDOR;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El proveedor con el id ' || P_ID_PROVEEDOR || ' Se eliminó');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al eliminar');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la eliminación');
END FIDE_PROVEEDORES_TB_ELIMINAR_SP;

-------------------------------Agregar Proveedor------------------------------------------------ 
PROCEDURE FIDE_PROVEEDORES_TB_INSERTAR_PROVEEDOR_SP (
    P_ID_ESTADOS IN VARCHAR2,
    P_ID_PAIS IN VARCHAR2,
    P_ID_PROVINCIA IN VARCHAR2,
    P_ID_CANTON IN VARCHAR2,
    P_ID_DISTRITO IN VARCHAR2,
    P_DIRECCION IN VARCHAR2,
    P_NOMBRE_PROVEEDOR IN VARCHAR2,
    P_TELEFONO IN VARCHAR2,
    P_CORREO IN VARCHAR2
) AS
BEGIN
    INSERT INTO FIDE_PROVEEDORES_TB (
        ID_ESTADOS,ID_PAIS,ID_PROVINCIA,ID_CANTON,ID_DISTRITO,DIRECCION,NOMBRE_PROVEEDOR,TELEFONO,CORREO
    ) 
    VALUES (
        P_ID_ESTADOS,P_ID_PAIS,P_ID_PROVINCIA,P_ID_CANTON,P_ID_DISTRITO,P_DIRECCION,P_NOMBRE_PROVEEDOR,P_TELEFONO,P_CORREO
    );

    COMMIT;
END;

----------------------- Agregar Producto------------------------------------
PROCEDURE FIDE_INVENTARIO_TB_REGISTRAR_SP (
    P_ID_INVENTARIO IN VARCHAR2,
    P_ID_PALLET IN VARCHAR2,
    P_NOMBRE IN VARCHAR2,
    P_CANTIDAD IN NUMBER,
    P_PRECIO IN NUMBER
) AS
BEGIN
    INSERT INTO FIDE_INVENTARIO_TB (
        FIDE_INVENTARIO_TB_ID_INVENTARIO_PK,
        ID_PALLET,
        NOMBRE,
        CANTIDAD,
        PRECIO
    )
    VALUES (
        P_ID_INVENTARIO,
        P_ID_PALLET,
        P_NOMBRE,
        P_CANTIDAD,
        P_PRECIO
    );

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Se agrego el producto con el id: ' || P_ID_INVENTARIO);
    
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error');
        ROLLBACK;
END FIDE_INVENTARIO_TB_REGISTRAR_SP;

-----------------------Actualizar Producto------------------------------------
PROCEDURE FIDE_INVENTARIO_TB_ACTUALIZAR_SP (
    P_ID_INVENTARIO FIDE_INVENTARIO_TB.FIDE_INVENTARIO_TB_ID_INVENTARIO_PK%TYPE,
    P_ID_PALLET FIDE_INVENTARIO_TB.ID_PALLET%TYPE,
    P_NOMBRE FIDE_INVENTARIO_TB.NOMBRE%TYPE,
    P_CANTIDAD FIDE_INVENTARIO_TB.CANTIDAD%TYPE,
    P_PRECIO FIDE_INVENTARIO_TB.PRECIO%TYPE,
    P_ID_ESTADOS FIDE_INVENTARIO_TB.ID_ESTADOS%TYPE
)
AS
BEGIN
    UPDATE FIDE_INVENTARIO_TB
    SET
        ID_PALLET = P_ID_PALLET,
        NOMBRE = P_NOMBRE,
        CANTIDAD = P_CANTIDAD,
        PRECIO = P_PRECIO,
        ID_ESTADOS = P_ID_ESTADOS
    WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = P_ID_INVENTARIO;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('Se modificó el producto con el nuevo estado.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error.');
        ROLLBACK;
END FIDE_INVENTARIO_TB_ACTUALIZAR_SP;

-----------------------Eliminar Producto------------------------------------
PROCEDURE FIDE_INVENTARIO_TB_ELIMINAR_SP (
    P_ID_INVENTARIO FIDE_INVENTARIO_TB.FIDE_INVENTARIO_TB_ID_INVENTARIO_PK%TYPE
)
AS
BEGIN
    DELETE FROM FIDE_INVENTARIO_TB
    WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = P_ID_INVENTARIO;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El producto se eliminó.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('No se pudo eliminar el artículo.');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la eliminación.');
END FIDE_INVENTARIO_TB_ELIMINAR_SP;

-----------------------Agregar Factura------------------------------------
PROCEDURE FIDE_FACTURAS_TB_REGISTRAR_SP (
    P_ID_FACTURA FIDE_FACTURAS_TB.FIDE_FACTURAS_TB_ID_FACTURAS_PK%TYPE,
    P_ID_CLIENTE FIDE_FACTURAS_TB.ID_CLIENTE%TYPE,
    P_ID_PROMOCION FIDE_FACTURAS_TB.ID_PROMOCION%TYPE,
    P_FECHA_VENTA FIDE_FACTURAS_TB.FECHA_VENTA%TYPE,
    P_IMPUESTOS FIDE_FACTURAS_TB.IMPUESTOS%TYPE,
    P_IDS_INVENTARIO VARCHAR2, 
    P_CANTIDADES VARCHAR2,  
    P_TOTAL_VENTA OUT FIDE_FACTURAS_TB.TOTAL_VENTA%TYPE
)
AS
    V_SUBTOTAL FIDE_FACTURAS_TB.SUBTOTAL%TYPE := 0;
    V_IDS SYS.ODCIVARCHAR2LIST := SYS.ODCIVARCHAR2LIST();
    V_QTY SYS.ODCINUMBERLIST := SYS.ODCINUMBERLIST();
    V_INDEX PLS_INTEGER;
BEGIN
    V_IDS := SYS.ODCIVARCHAR2LIST(P_IDS_INVENTARIO);
    V_QTY := SYS.ODCINUMBERLIST(P_CANTIDADES);
    FOR V_INDEX IN 1..V_IDS.COUNT LOOP
        DECLARE
            V_PRECIO_UNITARIO FIDE_INVENTARIO_TB.PRECIO%TYPE := 0;
        BEGIN
            SELECT PRECIO INTO V_PRECIO_UNITARIO 
            FROM FIDE_INVENTARIO_TB
            WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
            V_SUBTOTAL := V_SUBTOTAL + (V_PRECIO_UNITARIO * V_QTY(V_INDEX));
            UPDATE FIDE_INVENTARIO_TB
            SET CANTIDAD = CANTIDAD - V_QTY(V_INDEX)
            WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
            IF SQL%ROWCOUNT = 0 THEN
                RAISE_APPLICATION_ERROR(-20001, 'Error con el ID ' || V_IDS(V_INDEX) || 'No se encontro el producto o no hay la cantidad suficiente.');
            END IF;
        END;
    END LOOP;
    P_TOTAL_VENTA := V_SUBTOTAL + P_IMPUESTOS;
    INSERT INTO FIDE_FACTURAS_TB (
        FIDE_FACTURAS_TB_ID_FACTURAS_PK,
        ID_CLIENTE,
        ID_PROMOCION,
        FECHA_VENTA,
        SUBTOTAL,
        IMPUESTOS,
        TOTAL_VENTA
    ) VALUES (
        P_ID_FACTURA,
        P_ID_CLIENTE,
        P_ID_PROMOCION,
        P_FECHA_VENTA,
        V_SUBTOTAL,
        P_IMPUESTOS,
        P_TOTAL_VENTA
    );
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La Factura con el ID ' || P_ID_FACTURA || ' Se ha registrado el Total es de:' || P_TOTAL_VENTA);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error');
        ROLLBACK;
END FIDE_FACTURAS_TB_REGISTRAR_SP;

-----------------------Modificar Factura------------------------------------
PROCEDURE FIDE_FACTURAS_TB_MODIFICAR_SP (
    P_ID_FACTURA FIDE_FACTURAS_TB.FIDE_FACTURAS_TB_ID_FACTURAS_PK%TYPE,
    P_ID_CLIENTE FIDE_FACTURAS_TB.ID_CLIENTE%TYPE,
    P_ID_PROMOCION FIDE_FACTURAS_TB.ID_PROMOCION%TYPE,
    P_FECHA_VENTA FIDE_FACTURAS_TB.FECHA_VENTA%TYPE,
    P_IMPUESTOS FIDE_FACTURAS_TB.IMPUESTOS%TYPE,
    P_IDS_INVENTARIO VARCHAR2, 
    P_CANTIDADES VARCHAR2, 
    P_TOTAL_VENTA OUT FIDE_FACTURAS_TB.TOTAL_VENTA%TYPE
)
AS
    V_SUBTOTAL FIDE_FACTURAS_TB.SUBTOTAL%TYPE := 0;
    V_IDS SYS.ODCIVARCHAR2LIST := SYS.ODCIVARCHAR2LIST();
    V_QTY SYS.ODCINUMBERLIST := SYS.ODCINUMBERLIST();
    V_INDEX PLS_INTEGER;
BEGIN
    V_IDS := SYS.ODCIVARCHAR2LIST(P_IDS_INVENTARIO);
    V_QTY := SYS.ODCINUMBERLIST(P_CANTIDADES);
    FOR V_INDEX IN 1..V_IDS.COUNT LOOP
        UPDATE FIDE_INVENTARIO_TB
        SET CANTIDAD = CANTIDAD + V_QTY(V_INDEX)
        WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
        IF SQL%ROWCOUNT = 0 THEN
            RAISE_APPLICATION_ERROR(-20001, 'Error al modificar el inventario para el producto: ' || V_IDS(V_INDEX));
        END IF;
    END LOOP;
    V_SUBTOTAL := 0; 
    FOR V_INDEX IN 1..V_IDS.COUNT LOOP
        DECLARE
            V_PRECIO_UNITARIO FIDE_INVENTARIO_TB.PRECIO%TYPE := 0;
        BEGIN
            SELECT PRECIO INTO V_PRECIO_UNITARIO
            FROM FIDE_INVENTARIO_TB
            WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
            V_SUBTOTAL := V_SUBTOTAL + (V_PRECIO_UNITARIO * V_QTY(V_INDEX));
            UPDATE FIDE_INVENTARIO_TB
            SET CANTIDAD = CANTIDAD - V_QTY(V_INDEX)
            WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
            IF SQL%ROWCOUNT = 0 THEN
                RAISE_APPLICATION_ERROR(-20001, 'Error con el ID ' || V_IDS(V_INDEX) || 'No se encontro el producto o no hay la cantidad suficiente.');
            END IF;
        END;
    END LOOP;
    P_TOTAL_VENTA := V_SUBTOTAL + P_IMPUESTOS;
    UPDATE FIDE_FACTURAS_TB
    SET 
        ID_CLIENTE = P_ID_CLIENTE,
        ID_PROMOCION = P_ID_PROMOCION,
        FECHA_VENTA = P_FECHA_VENTA,
        SUBTOTAL = V_SUBTOTAL,
        IMPUESTOS = P_IMPUESTOS,
        TOTAL_VENTA = P_TOTAL_VENTA
    WHERE FIDE_FACTURAS_TB_ID_FACTURAS_PK = P_ID_FACTURA;
    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La Factura con el ID ' || P_ID_FACTURA || ' Se ha modificado el Total es de:' || P_TOTAL_VENTA);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error');
        ROLLBACK;
END FIDE_FACTURAS_TB_MODIFICAR_SP;

-----------------------Eliminar Factura------------------------------------
PROCEDURE FIDE_FACTURAS_TB_ELIMINAR_SP (
    P_ID_FACTURA FIDE_FACTURAS_TB.FIDE_FACTURAS_TB_ID_FACTURAS_PK%TYPE,
    P_IDS_INVENTARIO VARCHAR2,
    P_CANTIDADES VARCHAR2  
)
AS
    V_IDS SYS.ODCIVARCHAR2LIST := SYS.ODCIVARCHAR2LIST();
    V_QTY SYS.ODCINUMBERLIST := SYS.ODCINUMBERLIST();
    V_INDEX PLS_INTEGER;
BEGIN
    IF P_IDS_INVENTARIO IS NOT NULL AND P_CANTIDADES IS NOT NULL THEN
        V_IDS := SYS.ODCIVARCHAR2LIST(P_IDS_INVENTARIO);
        V_QTY := SYS.ODCINUMBERLIST(P_CANTIDADES);
        FOR V_INDEX IN 1..V_IDS.COUNT LOOP
            UPDATE FIDE_INVENTARIO_TB
            SET CANTIDAD = CANTIDAD + V_QTY(V_INDEX)
            WHERE FIDE_INVENTARIO_TB_ID_INVENTARIO_PK = V_IDS(V_INDEX);
            IF SQL%ROWCOUNT = 0 THEN
                RAISE_APPLICATION_ERROR(-20001, 'Error al modificar el inventario para el producto: ' || V_IDS(V_INDEX));
            END IF;
        END LOOP;
    END IF;

    DELETE FROM FIDE_FACTURAS_TB
    WHERE FIDE_FACTURAS_TB_ID_FACTURAS_PK = P_ID_FACTURA;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La Factura con el ID ' || P_ID_FACTURA || ' se ha eliminado correctamente.');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al eliminar factura.');
        ROLLBACK;
END FIDE_FACTURAS_TB_ELIMINAR_SP;

-----------------------Registrar promocion------------------------------------
PROCEDURE FIDE_PROMOCIONES_TB_REGISTRAR_SP (
    P_ID_PROMOCION FIDE_PROMOCIONES_TB.FIDE_PROMOCIONES_TB_ID_PROMOCION_PK%TYPE,
    P_ID_FACTURA FIDE_PROMOCIONES_TB.ID_FACTURAS%TYPE,
    P_NOMBRE_PROMOCION FIDE_PROMOCIONES_TB.NOMBRE_PROMOCION%TYPE,
    P_FECHA_INICIO FIDE_PROMOCIONES_TB.FECHA_INICIO%TYPE,
    P_FECHA_FIN FIDE_PROMOCIONES_TB.FECHA_FIN%TYPE,
    P_DESCRIPCION FIDE_PROMOCIONES_TB.DESCRIPCION%TYPE
)
AS
BEGIN
    INSERT INTO FIDE_PROMOCIONES_TB (
        FIDE_PROMOCIONES_TB_ID_PROMOCION_PK,
        ID_FACTURAS,
        NOMBRE_PROMOCION,
        FECHA_INICIO,
        FECHA_FIN,
        DESCRIPCION
    ) VALUES (
        P_ID_PROMOCION,
        P_ID_FACTURA,
        P_NOMBRE_PROMOCION,
        P_FECHA_INICIO,
        P_FECHA_FIN,
        P_DESCRIPCION
    );

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La promoción se registró');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('No se pudo registrar la promoción');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló el registro');
END FIDE_PROMOCIONES_TB_REGISTRAR_SP;

-----------------------modificar promocion------------------------------------
PROCEDURE FIDE_PROMOCIONES_TB_MODIFICAR_SP (
    P_ID_PROMOCION FIDE_PROMOCIONES_TB.FIDE_PROMOCIONES_TB_ID_PROMOCION_PK%TYPE,
    P_NOMBRE_PROMOCION FIDE_PROMOCIONES_TB.NOMBRE_PROMOCION%TYPE,
    P_FECHA_INICIO FIDE_PROMOCIONES_TB.FECHA_INICIO%TYPE,
    P_FECHA_FIN FIDE_PROMOCIONES_TB.FECHA_FIN%TYPE,
    P_DESCRIPCION FIDE_PROMOCIONES_TB.DESCRIPCION%TYPE
)
AS
BEGIN
    UPDATE FIDE_PROMOCIONES_TB
    SET
        NOMBRE_PROMOCION = P_NOMBRE_PROMOCION,
        FECHA_INICIO = P_FECHA_INICIO,
        FECHA_FIN = P_FECHA_FIN,
        DESCRIPCION = P_DESCRIPCION
    WHERE FIDE_PROMOCIONES_TB_ID_PROMOCION_PK = P_ID_PROMOCION;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La promoción se modificó');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al modificar la promoción');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la modificación');
END FIDE_PROMOCIONES_TB_MODIFICAR_SP;

-----------------------Eliminar Promocion------------------------------------
PROCEDURE FIDE_PROMOCIONES_TB_ELIMINAR_SP (
    P_ID_PROMOCION FIDE_PROMOCIONES_TB.FIDE_PROMOCIONES_TB_ID_PROMOCION_PK%TYPE
)
AS
BEGIN
    DELETE FROM FIDE_PROMOCIONES_TB
    WHERE FIDE_PROMOCIONES_TB_ID_PROMOCION_PK = P_ID_PROMOCION;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('La promoción con el ID ' || P_ID_PROMOCION || ' se ha eliminado');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al eliminar la promoción');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la eliminación');
END FIDE_PROMOCIONES_TB_ELIMINAR_SP;

-----------------------Registrar Descuento------------------------------------
PROCEDURE FIDE_DESCUENTO_TB_REGISTRAR_SP (
    P_ID_DESCUENTO FIDE_DESCUENTO_TB.FIDE_DESCUENTO_TB_ID_DESCUENTO_PK%TYPE,
    P_ID_TIPO_DESCUENTO FIDE_DESCUENTO_TB.ID_TIPO_DESCUENTO%TYPE,
    P_VALOR FIDE_DESCUENTO_TB.VALOR%TYPE
)
AS
BEGIN
    INSERT INTO FIDE_DESCUENTO_TB (
        FIDE_DESCUENTO_TB_ID_DESCUENTO_PK,
        ID_TIPO_DESCUENTO,
        VALOR
    ) VALUES (
        P_ID_DESCUENTO,
        P_ID_TIPO_DESCUENTO,
        P_VALOR
    );

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El descuento se registró');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al registrar el descuento');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló el registro');
END FIDE_DESCUENTO_TB_REGISTRAR_SP;

-----------------------Editar Descuento------------------------------------
PROCEDURE FIDE_DESCUENTO_TB_MODIFICAR_SP (
    P_ID_DESCUENTO FIDE_DESCUENTO_TB.FIDE_DESCUENTO_TB_ID_DESCUENTO_PK%TYPE,
    P_ID_TIPO_DESCUENTO FIDE_DESCUENTO_TB.ID_TIPO_DESCUENTO%TYPE,
    P_VALOR FIDE_DESCUENTO_TB.VALOR%TYPE
)
AS
BEGIN
    UPDATE FIDE_DESCUENTO_TB
    SET
        ID_TIPO_DESCUENTO = P_ID_TIPO_DESCUENTO,
        VALOR = P_VALOR
    WHERE FIDE_DESCUENTO_TB_ID_DESCUENTO_PK = P_ID_DESCUENTO;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El descuento se ha modificado');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al modificar el descuento');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la modificación');
END FIDE_DESCUENTO_TB_MODIFICAR_SP;

-----------------------Eliminar Descuento------------------------------------
PROCEDURE FIDE_DESCUENTO_TB_ELIMINAR_SP (
    P_ID_DESCUENTO FIDE_DESCUENTO_TB.FIDE_DESCUENTO_TB_ID_DESCUENTO_PK%TYPE
)
AS
BEGIN
    DELETE FROM FIDE_DESCUENTO_TB
    WHERE FIDE_DESCUENTO_TB_ID_DESCUENTO_PK = P_ID_DESCUENTO;

    COMMIT;
    DBMS_OUTPUT.PUT_LINE('El descuento se eliminó');
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error al eliminar el descuento');
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Se canceló la eliminación');
END FIDE_DESCUENTO_TB_ELIMINAR_SP;

-----------------------Registrar pallet------------------------------------
PROCEDURE FIDE_PALLETS_TB_INSERTAR_SP (
    P_ID_PROVEEDORES IN VARCHAR2,
    P_ID_ESTADOS IN VARCHAR2,
    P_DESCRIPCION IN VARCHAR2
) AS
BEGIN
    INSERT INTO FIDE_PALLETS_TB (
        FIDE_PALLETS_TB_ID_PALLET_PK,
        ID_PROVEEDORES,
        ID_ESTADOS,
        DESCRIPCION,
        ESTADO
    )
    VALUES (
        NULL, 
        P_ID_PROVEEDORES,
        P_ID_ESTADOS,
        P_DESCRIPCION,
        'ACTIVO'
    );

    COMMIT;
END;

-----------------------Editar pallet------------------------------------
PROCEDURE FIDE_PALLETS_TB_ACTUALIZAR_SP (
    P_ID_PALLET IN FIDE_PALLETS_TB.FIDE_PALLETS_TB_ID_PALLET_PK%TYPE,
    P_ID_PROVEEDORES IN FIDE_PALLETS_TB.ID_PROVEEDORES%TYPE,
    P_ID_ESTADOS IN FIDE_PALLETS_TB.ID_ESTADOS%TYPE,
    P_DESCRIPCION IN FIDE_PALLETS_TB.DESCRIPCION%TYPE
) AS
BEGIN
    UPDATE FIDE_PALLETS_TB
    SET
        ID_PROVEEDORES = P_ID_PROVEEDORES,
        ID_ESTADOS = P_ID_ESTADOS,
        DESCRIPCION = P_DESCRIPCION,
        FECHA_MODIFICACION = SYSDATE
    WHERE FIDE_PALLETS_TB_ID_PALLET_PK = P_ID_PALLET;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
END;

-----------------------eliminar pallet------------------------------------
PROCEDURE FIDE_PALLETS_TB_ELIMINAR_SP (
    P_ID_PALLET IN FIDE_PALLETS_TB.FIDE_PALLETS_TB_ID_PALLET_PK%TYPE
) AS
BEGIN
    DELETE FROM FIDE_PALLETS_TB
    WHERE FIDE_PALLETS_TB_ID_PALLET_PK = P_ID_PALLET;

    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
END;

-----------------------agregar detalle factura------------------------------------
PROCEDURE FIDE_DETALLES_FACTURAS_AGREGAR_SP (
    P_ID_DETALLE IN VARCHAR2,
    P_ID_FACTURAS IN VARCHAR2,
    P_ID_ESTADOS IN VARCHAR2,
    P_ID_INVENTARIO IN VARCHAR2,
    P_CANTIDAD_VENDIDA IN INT,
    P_PRECIO_UNITARIO IN DECIMAL,
    P_PRECIO_TOTAL_UNITARIO IN DECIMAL
)
AS
BEGIN
    INSERT INTO FIDE_DETALLES_FACTURAS_TB (
        FIDE_DETALLES_FACTURAS_TB_ID_DETALLE_PK,
        ID_FACTURAS,
        ID_ESTADOS,
        ID_INVENTARIO,
        CANTIDAD_VENDIDA,
        PRECIO_UNITARIO,
        PRECIO_TOTAL_UNITARIO
    ) VALUES (
        P_ID_DETALLE,
        P_ID_FACTURAS,
        P_ID_ESTADOS,
        P_ID_INVENTARIO,
        P_CANTIDAD_VENDIDA,
        P_PRECIO_UNITARIO,
        P_PRECIO_TOTAL_UNITARIO
    );
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error en la ejecución del procedimiento.');
        RAISE;
END FIDE_DETALLES_FACTURAS_AGREGAR_SP;

-----------------------eliminar detalle factura------------------------------------
PROCEDURE FIDE_DETALLES_FACTURAS_ELIMINAR_SP (
    P_ID_DETALLE IN VARCHAR2
)
AS
BEGIN
    DELETE FROM FIDE_DETALLES_FACTURAS_TB
    WHERE FIDE_DETALLES_FACTURAS_TB_ID_DETALLE_PK = P_ID_DETALLE;
    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error en la ejecución del procedimiento.');
        RAISE;
END FIDE_DETALLES_FACTURAS_ELIMINAR_SP;

-----------------------modificar detalle factura------------------------------------
PROCEDURE FIDE_DETALLES_FACTURAS_MODIFICAR_SP (
    P_ID_DETALLE IN VARCHAR2,
    P_ID_FACTURAS IN VARCHAR2,
    P_ID_ESTADOS IN VARCHAR2,
    P_ID_INVENTARIO IN VARCHAR2,
    P_CANTIDAD_VENDIDA IN INT,
    P_PRECIO_UNITARIO IN DECIMAL,
    P_PRECIO_TOTAL_UNITARIO IN DECIMAL
)
AS
BEGIN
    UPDATE FIDE_DETALLES_FACTURAS_TB
    SET 
        ID_FACTURAS = P_ID_FACTURAS,
        ID_ESTADOS = P_ID_ESTADOS,
        ID_INVENTARIO = P_ID_INVENTARIO,
        CANTIDAD_VENDIDA = P_CANTIDAD_VENDIDA,
        PRECIO_UNITARIO = P_PRECIO_UNITARIO,
        PRECIO_TOTAL_UNITARIO = P_PRECIO_TOTAL_UNITARIO
    WHERE FIDE_DETALLES_FACTURAS_TB_ID_DETALLE_PK = P_ID_DETALLE;
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error en la ejecución del procedimiento.');
        RAISE;
END FIDE_DETALLES_FACTURAS_MODIFICAR_SP;

-----------------------eliminar tipo descuento------------------------------------
PROCEDURE FIDE_TIPO_DESCUENTO_ELIMINAR_SP (
    P_ID_TIPO_DESCUENTO IN VARCHAR2
)
AS
BEGIN
    DELETE FROM FIDE_TIPO_DESCUENTO_TB
    WHERE FIDE_TIPO_DESCUENTO_TB_ID_TIPO_DESCUENTO_PK = P_ID_TIPO_DESCUENTO;
    COMMIT;

EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error en la ejecución del procedimiento.');
        RAISE;
END FIDE_TIPO_DESCUENTO_ELIMINAR_SP;

-----------------------procedimiento/cursor 1 listar clientes que tienen un estado espec�fico---------------------------------
PROCEDURE FIDE_CLIENTES_LISTAR_POR_ESTADO_SP(
    P_ESTADO IN VARCHAR2
) IS
    CURSOR C_CLIENTES IS
        SELECT FIDE_CLIENTES_TB_ID_CLIENTE_PK AS ID_CLIENTE,
               NOMBRE, 
               CORREO, 
               TELEFONO
        FROM FIDE_CLIENTES_TB
        WHERE ESTADO = P_ESTADO;
    V_CLIENTE_ID VARCHAR2(200);
    V_NOMBRE VARCHAR2(255);
    V_CORREO VARCHAR2(255);
    V_TELEFONO VARCHAR2(20);
BEGIN
    OPEN C_CLIENTES;
    LOOP
        FETCH C_CLIENTES INTO V_CLIENTE_ID, V_NOMBRE, V_CORREO, V_TELEFONO;
        EXIT WHEN C_CLIENTES%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE('ID : ' || V_CLIENTE_ID ||', Nombre: ' || V_NOMBRE || ', Correo: ' || V_CORREO || ', Tel�fono: ' || V_TELEFONO);
    END LOOP;
    CLOSE C_CLIENTES;
END FIDE_CLIENTES_LISTAR_POR_ESTADO_SP;

-----------------------procedimiento/cursor 2 lista las facturas generadas en un rango de fechas---------------------------------
PROCEDURE FIDE_FACTURAS_LISTAR_POR_FECHA_SP(
    P_FECHA_INICIO IN DATE,
    P_FECHA_FIN IN DATE
) IS
    CURSOR C_FACTURAS IS
        SELECT FIDE_FACTURAS_TB_ID_FACTURAS_PK AS ID_FACTURA,
               FECHA_VENTA,
               TOTAL_VENTA,
               SUBTOTAL,
               IMPUESTOS
        FROM FIDE_FACTURAS_TB
        WHERE FECHA_VENTA BETWEEN P_FECHA_INICIO AND P_FECHA_FIN;
    V_ID_FACTURA VARCHAR2(200);
    V_FECHA_VENTA DATE;
    V_TOTAL_VENTA DECIMAL(10, 2);
    V_SUBTOTAL DECIMAL(10, 2);
    V_IMPUESTOS DECIMAL(10, 2);
BEGIN
    OPEN C_FACTURAS;
    LOOP
        FETCH C_FACTURAS INTO V_ID_FACTURA, V_FECHA_VENTA, V_TOTAL_VENTA, V_SUBTOTAL, V_IMPUESTOS;
        EXIT WHEN C_FACTURAS%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE('Factura ID: ' || V_ID_FACTURA || ', Fecha: ' || V_FECHA_VENTA || ', Total: ' || V_TOTAL_VENTA ||  ', Subtotal: ' || V_SUBTOTAL || ', Impuestos: ' || V_IMPUESTOS);
    END LOOP;
    CLOSE C_FACTURAS;
END FIDE_FACTURAS_LISTAR_POR_FECHA_SP;

-----------------------procedimiento/cursor 3 lista las promociones activas y su rango de fechas---------------------------------
PROCEDURE FIDE_PROMOCIONES_LISTAR_ACTIVAS_SP IS
    CURSOR C_PROMOCIONES IS
        SELECT FIDE_PROMOCIONES_TB_ID_PROMOCION_PK AS ID_PROMOCION,
               NOMBRE_PROMOCION,
               FECHA_INICIO,
               FECHA_FIN
        FROM FIDE_PROMOCIONES_TB
        WHERE ESTADO = 'ACTIVO';
    V_ID_PROMOCION VARCHAR2(200);
    V_NOMBRE_PROMOCION VARCHAR2(255);
    V_FECHA_INICIO DATE;
    V_FECHA_FIN DATE;
BEGIN
    OPEN C_PROMOCIONES;
    LOOP
        FETCH C_PROMOCIONES INTO V_ID_PROMOCION, V_NOMBRE_PROMOCION, V_FECHA_INICIO, V_FECHA_FIN;
        EXIT WHEN C_PROMOCIONES%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE('Promoci�n ID: ' || V_ID_PROMOCION || ', Nombre: ' || V_NOMBRE_PROMOCION || ', Inicio: ' || V_FECHA_INICIO || ', Fin: ' || V_FECHA_FIN);
    END LOOP;
    CLOSE C_PROMOCIONES;
END FIDE_PROMOCIONES_LISTAR_ACTIVAS_SP;

-----------------------procedimiento/cursor 5  lista los clientes que tienen facturas con un total mayor a un monto---------------------------------
PROCEDURE FIDE_CLIENTES_FACTURAS_MAYOR_MONTO_SP(
    P_MONTO_MINIMO IN DECIMAL
) IS
    CURSOR C_CLIENTES_FACTURAS IS
        SELECT DISTINCT C.FIDE_CLIENTES_TB_ID_CLIENTE_PK AS ID_CLIENTE,
                        C.NOMBRE AS NOMBRE_CLIENTE,
                        F.TOTAL_VENTA
        FROM FIDE_CLIENTES_TB C
        JOIN FIDE_FACTURAS_TB F ON C.FIDE_CLIENTES_TB_ID_CLIENTE_PK = F.ID_CLIENTE
        WHERE F.TOTAL_VENTA > P_MONTO_MINIMO;
    V_ID_CLIENTE VARCHAR2(200);
    V_NOMBRE_CLIENTE VARCHAR2(255);
    V_TOTAL_VENTA DECIMAL(10, 2);
BEGIN
    OPEN C_CLIENTES_FACTURAS;
    LOOP
        FETCH C_CLIENTES_FACTURAS INTO V_ID_CLIENTE, V_NOMBRE_CLIENTE, V_TOTAL_VENTA;
        EXIT WHEN C_CLIENTES_FACTURAS%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE('Cliente ID: ' || V_ID_CLIENTE || ', Nombre: ' || V_NOMBRE_CLIENTE || ', Total Venta: ' || V_TOTAL_VENTA);
    END LOOP;
    CLOSE C_CLIENTES_FACTURAS;
END FIDE_CLIENTES_FACTURAS_MAYOR_MONTO_SP;


END FIDE_SUMASTORECR_PROCEDIMIENTOS_PKG;</pre>
</div>
</div>
</div>
</body>
</html>
